# Worksection Timetracker Integration

Цей додаток є інтеграцією для Worksection Timetracker. Він дозволяє зберігати затреканий час, інформацію про проекти, розробників та таски в окремій базі даних. Також надає функціонал для формування графіків відстеження норм та автоматичної відправки повідомлень користувачам у Discord.

---

## Зміст

* [Про проект](#про-проект)
* [Функціональні можливості](#функціональні-можливості)
* [Технології](#технології)
* [Встановлення](#встановлення)
* [Налаштування (Конфігурація)](#налаштування-конфігурація)
* [Використання](#використання)
* [Структура бази даних](#структура-бази-даних)
* [Тестування](#тестування)
* [Плани на майбутнє](#плани-на-майбутнє)
* [Авторство](#авторство)
* [Ліцензія](#ліцензія)

---

## Про проект

Цей додаток розроблено для розширення можливостей Worksection Timetracker. Його основні функції включають:

- **Зберігання даних:** Ведення окремої бази даних для затреканого часу, інформації про проекти, розробників та конкретні таски, що забезпечує більшу гнучкість та контроль над даними.
- **Аналітика та звітність:** Можливість генерації детальних звітів та графіків для візуалізації даних про час, ефективне відстеження норм, ідентифікації відхилень та оптимізації робочих процесів.
- **Сповіщення Discord:** Автоматичні сповіщення про важливі події (наприклад, перевищення норм часу, завершення тасків, нагадування) безпосередньо в Discord-канали або особисті повідомлення для швидкого реагування.

---

## Функціональні можливості

- **Автономна база даних часу:** Зберігання затреканого часу, проектів, розробників та тасків незалежно від Worksection, що дозволяє створювати власні звіти та аналітику.
- **Розширена аналітика:** Інструменти для побудови кастомних графіків та звітів на основі збережених даних, допомагаючи відстежувати норми та виявляти аномалії.
- **Інтеграція з Discord:** Надсилання автоматичних, настроюваних повідомлень у Discord для інформування команди про прогрес, проблеми чи важливі оновлення.
- **Управління проектами та завданнями:** Можливість синхронізації або ручного додавання та оновлення інформації про проекти та таски.
- **Керування користувачами/розробниками:** Відстеження індивідуального внеску та ефективності кожного розробника.

---

## Технології

Проект розроблено з використанням:

- **Backend:** Node.js, Express.js
- **База даних:** PostgreSQL (Sequelize ORM)
- **Інтеграції:** Axios (HTTP-запити до Worksection API), discord.js (взаємодія з Discord API)
- **Аутентифікація:** bcrypt, express-session, crypto-js
- **Шаблонізатор:** EJS
- **Змінні оточення:** dotenv
- **Моніторинг (розробка):** nodemon

---

## Встановлення

1. **Клонуйте репозиторій:**
    ```bash
    git clone https://github.com/RuslanPGitHub/ws_timetracker.git
    cd timetracker
    ```
2. **Встановіть залежності:**
    ```bash
    npm install
    ```
3. **Налаштуйте базу даних:**
    - Переконайтеся, що PostgreSQL встановлено і запущено.
    - Створіть базу даних для проекту.
4. **Створіть файл `.env`** і налаштуйте змінні (див. розділ [Налаштування (Конфігурація)](#налаштування-конфігурація)).
5. **Запустіть міграції (якщо використовується Sequelize):**
    ```bash
    npx sequelize db:migrate
    ```

---

## Налаштування (Конфігурація)

Приклад `.env` файлу з поясненнями:

```dotenv
# General
PORT=3000
SESSION_SECRET=your_strong_secret_key_here
NODE_ENV=development

# DB
DATABASE_URL=postgresql://user:password@host:port/dbname?sslmode=require

# Worksection
WORKSECTION_API_KEY=your_worksection_api_key
WORKSECTION_BASE_URL=https://yourcompany.worksection.com

# Discord
DISCORD_WEBHOOK_URL=your_discord_webhook_url
# DISCORD_BOT_TOKEN=your_discord_bot_token (якщо використовуєте бота)
# DISCORD_CHANNEL_ID=discord_channel_id (для бота)
```

- **PORT:** Порт для запуску сервера.
- **SESSION_SECRET:** Унікальний ключ для шифрування сесій.
- **NODE_ENV:** Середовище (development/production).
- **DATABASE_URL:** Підключення до PostgreSQL.
- **WORKSECTION_API_KEY:** Ключ для Worksection API.
- **WORKSECTION_BASE_URL:** Базова URL Worksection.
- **DISCORD_WEBHOOK_URL:** Вебхук Discord для сповіщень.
- **DISCORD_BOT_TOKEN, DISCORD_CHANNEL_ID:** Для інтеграції через бота (опціонально).

---

## Використання

- Запуск у режимі розробки (з автоматичним перезапуском):

    ```bash
    npm run dev
    ```

- Запуск у продакшені:

    ```bash
    npm start
    ```

Додаток буде доступний за `http://localhost:PORT` (порт із `.env`).

---

## Структура бази даних

| Таблиця                   | Поля                                                                                                                                       | Опис                                            |
|---------------------------|--------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|
| **users**                 | `id` (PK, uuid), `username` (унікальний), `password`, `role`, `description`, `created_at`                                                  | Користувачі                                     |
| **developers**            | `id` (PK, uuid), `ws_avatar`, `ws_id` (унікальний), `ws_name`, `ws_title`, `ws_email`, `ws_phone`, `discord_id` (унікальний), `created_at` | Розробники, інтеграція з Worksection та Discord |
| **projects**              | `id` (PK, uuid), `worksection_id` (унікальний), `name` (унікальна), `created_at`                                                           | Проекти                                         |
| **tasks**                 | `id` (PK, uuid), `project_id` (FK -> projects.id), `name`, `worksection_url`, `description`, `created_at`                                  | Завдання                                        |
| **tracked_hours**         | `id` (PK, uuid), `developer_id` (FK -> developers.id), `task_id` (FK -> tasks.id), `date`, `hours`, `created_at`                           | Записи затреканого часу                         |
| **settings**              | `id` (PK, uuid), `key` (унікальний), `value`, `created_at`, `updated_at`                                                                   | Налаштування                                    |
| **discord_notifications** | `id` (PK, uuid), `developer_id` (FK -> developers.id), `message`, `sent_at`                                                                | Сповіщення Discord                              |
| **logs**                  | `id` (PK, uuid), `scan_date`, `developers_checked`, `errors`                                                                               | Логи роботи                                     |

---

## Тестування

Якщо тести присутні, запустіть командою:

```bash
npm test
```

Переконайтеся, що всі тестові залежності встановлені.

---

## Плани на майбутнє
### ---1.0.0---
- Створення сповіщень для розробників про забутий таймер
### ---1.1.0---
- Додати можливість сортування таблиць.
- Вирішити Problem of Double Submit.
- Додати логування.
### ---1.2.0---
- Прибрати відображення помилок на production.
- Додати можливість реєстрації.
- Створення сторінки про користувача (всі його дані).
- Реалізація автоматичного формування звіту про попередній робочий день з попереднім переглядом та можливістю редагування.
- Покращення UI та візуалізації даних.
### ---2.0.0---
- Змінити структуру на ES модулі.
- Зміна БД на mongodb.
- Повна інтеграція з worksection (реалізація усіх методів API).

---

## Авторство

Розробник: Руслан Попадюк  
Контакт: r.popadiuk@avivi.com.ua  
Організація: Avivi

---

## Ліцензія

Проект поширюється під ліцензією MIT. Деталі у файлі LICENSE.

Copyright (c) 2025 Ruslan Popadiuk
